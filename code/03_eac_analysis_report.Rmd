---
title: "Aid's Effect on Crop Coverage"
author: "Billy Matthias"
date: "10/01/2017"
output:
  html_document:
    fig_caption: yes
    fig_height: 5
    fig_width: 7
    highlight: tango
    theme: readable
  pdf_document:
    fig_caption: yes
    highlight: tango
  word_document: default
geometry: margin=1in
fontsize: 10pt
---
# Aid's Effect on Crop Coverage: Analysis Overview
```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo=FALSE)

library(sandwich)
library(RCurl)
library(interplot)
library(tidyverse)
library(ggplot2)
library(modelr)
library(haven)
library(magrittr)
options(na.action = na.warn)
library(xtable)
library(knitr)
library(texreg)
library(broom)
library(htmltools)
library(stringr)

## Set file paths --------------------------------------------------------------
# Set working directory to where you saved project directory (folder)
# 'dir.home' the only file path you need to change!
dir.home <- file.path("/Users/wtmatthias/Google Drive/Mike RA")

dir.outdata <- file.path(dir.home,
                         "elections_aid_cropshare/data_201708/01_outputdata")

dir.analysis <- file.path(dir.home,
                          "elections_aid_cropshare/data_201708")
dir.figures.tables <- file.path(
                    dir.home,
                    "elections_aid_cropshare/data_201708/02_tables_and_figures")

## Load Data -------------------------------------------------------------------
load(file = file.path(
  dir.outdata,
  "eac_vio_muni_cross-section.RData"
))



## Functions -------------------------------------------------------------------
## ROBUST SEs
robust <- function(model.object){
  require(sandwich)
  
  sandwich_se <- sqrt(diag(vcovHC(model.object, type = "HC1")))
  
  z_stat <- coef(model.object)/sandwich_se
  p_values <- pchisq(z_stat^2, 1, lower.tail=FALSE)
  
  robust.mod <- summary(model.object)
  
  robust.mod$coefficients[, 2] <- sandwich_se
  robust.mod$coefficients[, 3] <- z_stat
  robust.mod$coefficients[, 4] <- p_values
  corrected <- robust.mod
  se.corrections <- list("robust.mod" = corrected, "sandwich_se" = sandwich_se,
                         "z_stat" = z_stat, "p_values" = p_values)
  se.corrections
}


## REG TABLE W/ ROBUST SEs TO .doc TABLE
# needs function "robust". also created in this script
robust_table <- function(linear.model, filename, title, coefnames, note,
                         latex = FALSE){
  require(texreg)
  sandwich_se <- linear.model %>% map(robust) %>% map(2)
  p_values <- linear.model %>% map(robust) %>% map(4)
  
  if (latex == TRUE && is.null(filename)){
    message("Printing code for latex table...")
    # Latex reg table
    latex_table <- texreg(linear.model,
                          file = NULL,
                          booktabs = TRUE,
                          dcolumn = TRUE,
                          table = TRUE,
                          sideways = TRUE,
                          stars = c(0.01, 0.05, 0.1),
                          custom.note = note,
                          digits = 2,
                          leading.zero = TRUE,
                          custom.model.names = str_c("(", seq_along(linear.model), ")"),
                          custom.coef.map = coefnames,
                          caption.above = TRUE,
                          caption = title,
                          override.se = sandwich_se,
                          override.pvalues = p_values,
                          # passed to extract() method for "lm"
                          include.adjr = TRUE,
                          include.rsquared = FALSE,
                          include.rmse = FALSE,
                          include.nobs = TRUE
    )
    return(latex_table)
  } else if (latex == FALSE && !is.null(filename)){
    # output table to .doc
    htmlreg(linear.model,
            file = filename,
            custom.note = note,
            digits = 2,
            stars = c(0.01, 0.05, 0.1),
            leading.zero = TRUE,
            custom.model.names = str_c("(", seq_along(linear.model), ")"),
            custom.coef.map = coefnames,
            caption.above = TRUE,
            caption = title,
            override.se = sandwich_se,
            override.pvalues = p_values,
            inline.css = FALSE,
            # better for Word doc
            doctype = TRUE,
            html.tag = TRUE,
            head.tag = TRUE,
            body.tag = TRUE,
            # passed to extract() method for "lm"
            include.adjr = TRUE,
            include.rsquared = FALSE,
            include.rmse = FALSE,
            include.nobs = TRUE
    )
    
  } else{
    message("Printing code for markdown table...")
    # html markdown in browser
    view_markdown <- htmlreg(linear.model,
                             file = NULL,
                             custom.note = note,
                             digits = 2,
                             stars = c(0.01, 0.05, 0.1),
                             leading.zero = TRUE,
                             custom.model.names = str_c("(", seq_along(linear.model), ")"),
                             custom.coef.map = coefnames,
                             caption.above = TRUE,
                             caption = title,
                             override.se = sandwich_se,
                             override.pvalues = p_values,
                             star.symbol = "*",
                             # better for markdown
                             doctype = FALSE,
                             html.tag = FALSE,
                             head.tag = FALSE,
                             body.tag = FALSE,
                             # passed to extract() method for "lm"
                             include.adjr = TRUE,
                             include.rsquared = FALSE,
                             include.rmse = FALSE,
                             include.nobs = TRUE
    )
    return(view_markdown)
  }
}

## robust SEs through map and purrr:
# sandwich_se <- map(cropveg.aid.coca1, ~ sqrt(diag(vcovHC(., type = "HC1")
# )
# )
# )
# z_stat <- map2(cropveg.aid.coca1, sandwich_se, ~ coef(.x)/.y)
# 
# p_values <- map(z_stat, ~ pchisq(.^2, 1, lower.tail=FALSE))


## EXAMPLE CODE FOR robust_table:

## table to .doc
# robust_table(linear.model, filename = filename, title, coefnames, note, latex = FALSE)
## table to html code
# html_table <- robust_table(linear.model, filename = NULL, title, coefnames, note, latex = FALSE)
# html_table
# html_table %>% HTML() %>% browsable() # view the html in R's viewer
## table to latex
# robust_table(linear.model, filename = NULL, title, coefnames, note, latex = TRUE)



## THREE WAY MARGINAL EFFECTS FUNCTION
ThreewayME.f <- function(M,X,Z,W,xlab,ylab,lloc,Min,Q1,Mean,Q3,Max,level,rob,hist)  
{ 
  ## A function to generate 3-way marginal effects plots in R with stars for set confidence levels. 
  ## Written by Joshua Gubler ~  http://joshuagubler.com
  ## Last updated: 26 April 2017
  ## Variables must be in the following order: y = x z w (control variables here) xz xw zw xzw .  Of course, the model can include as many control variables as you need; the following code specifically uses just the variables we want for the interaction.  As long as you get the first three variables in correct order, R will correctly order the interaction terms.
  ## M = an object of type "lm," "glm," or other estimation -- i.e. the object that contains the regression estimation you seek to plot
  ## X = the variable whose effect on Y you seek to plot
  ## Z = the first moderating variable (will be positioned on the X-axis of the plot)
  ## W = the second moderating variable (the lines on the plot)
  ## xlab = Label for x-axis (in quotes)
  ## ylab = label for y-axis (in quotes)
  ## lloc = location of the legend for the plot, use values like "bottomleft"
  ## Min, Q1, Mean, Q3, Max = titles for each of these quartiles to be put in the legend -- i.e. "Min Q88" (titles must be in quotes)
  ## level = to set the confidence level.  Two options (don't put these in quotes): 95, 90.  Stars will show on lines that are significant at the level you set.  If you do not put in either option, stars will show on all lines.
  ## rob = if you desire Huber-White robust standard errors
  ## hist = if hist, then you will get a density histogram of your variable on the X-axis.  If not, then you will get a rug plot of your variable on the X-axis
  
  ## Example: ThreewayME.f(estimation.lm,ses,edu,pop,"Education levels","Effect of SES on Civil War","bottomleft","Min Pop","1Q Pop","Mean Pop","3Q Pop","Max Pop",90,rob,hist)
  
  ##Note: this function can be altered easily to change the number of lines in "W", depending on how many one prefers (W could be made dichtomous, etc.)
  
  S <- summary(M)
  N <- c(1:20)
  
  # Create 20 equally spaced values in a vector between min and max on the Z variable            
  zmin <- rep(min(Z,na.rm=TRUE), 20) 
  zmax <- rep(max(Z, na.rm=TRUE), 20) 
  Znew <- (((N-1)/(20-1))*(zmax-zmin))+zmin
  
  # Generate the values of W for which you want to calculate the marginal effect (and standard errors) of X on Y.  Note: the default is the following percentiles, but these can be changed.  If one deletes lines here, the corresponding lines will need to be deleted later in the function.
  W0 <- quantile(W,   0, na.rm=TRUE) 
  W1 <- quantile(W, .25, na.rm=TRUE)
  W2 <- quantile(W, .50, na.rm=TRUE)
  W3 <- quantile(W, .75, na.rm=TRUE)
  W4 <- quantile(W,   1, na.rm=TRUE)
  
  # Grab elements of coefficient and vcov matrix.                                               
  require(sandwich)
  H <- head(S$coefficients,4)
  T <- tail(S$coefficients,4)
  b <- rbind(H,T)
  if(missing(rob)){Vcov <- vcov(M)}
  else{
    Vcov <- vcovHC(M,"HC1")
  }
  Vcov <- as.data.frame(Vcov)
  Vcov1 <- Vcov[,c(1:4)]
  Vcov2 <- Vcov[,-c(3:0-length(Vcov))]
  Vcov <- cbind(Vcov1,Vcov2)
  Vh <- head(Vcov,4)
  Vt <- tail(Vcov,4)
  V <- rbind(Vh,Vt)
  
  b1 <- b[2,1]
  b4 <- b[5,1]
  b5 <- b[6,1]
  b7 <- b[8,1]
  
  varb1 <- V[2,2]
  varb4 <- V[5,5]
  varb5 <- V[6,6]
  varb7 <- V[8,8]
  
  covb1b4 <- V[5,2]
  covb1b5 <- V[6,2]
  covb1b7 <- V[8,2]
  covb4b5 <- V[6,5]
  covb4b7 <- V[8,5]
  covb5b7 <- V[8,6]
  
  # Calculate ME values for all levels of W
  conb0 <- b1+b4*Znew+b5*W0+b7*(Znew*W0)
  conb1 <- b1+b4*Znew+b5*W1+b7*(Znew*W1)
  conb2 <- b1+b4*Znew+b5*W2+b7*(Znew*W2)
  conb3 <- b1+b4*Znew+b5*W3+b7*(Znew*W3)
  conb4 <- b1+b4*Znew+b5*W4+b7*(Znew*W4)
  
  # Calculate standard errors for all levels of W
  if(missing(rob)){
    conse0 <- sqrt(varb1         
                   + varb4*(Znew^2) + varb5*(W0^2) + varb7*(Znew^2)*(W0^2)
                   + 2*Znew*covb1b4 + 2*W0*covb1b5 + 2*Znew*W0*covb1b7 + 2*Znew*W0*covb4b5
                   + 2*W0*(Znew^2)*covb4b7 + 2*(W0^2)*Znew*covb5b7)
    
    conse1 <- sqrt(varb1         
                   + varb4*(Znew^2) + varb5*(W1^2) + varb7*(Znew^2)*(W1^2)      
                   + 2*Znew*covb1b4 + 2*W1*covb1b5 + 2*Znew*W1*covb1b7 + 2*Znew*W1*covb4b5
                   + 2*W1*(Znew^2)*covb4b7 + 2*(W1^2)*Znew*covb5b7)
    
    conse2 <- sqrt(varb1       
                   + varb4*(Znew^2) + varb5*(W2^2) + varb7*(Znew^2)*(W2^2) 
                   + 2*Znew*covb1b4 + 2*W2*covb1b5 + 2*Znew*W2*covb1b7 + 2*Znew*W2*covb4b5
                   + 2*W2*(Znew^2)*covb4b7 + 2*(W2^2)*Znew*covb5b7)
    
    conse3 <- sqrt(varb1
                   + varb4*(Znew^2) + varb5*(W3^2) + varb7*(Znew^2)*(W3^2)
                   + 2*Znew*covb1b4 + 2*W3*covb1b5 + 2*Znew*W3*covb1b7 + 2*Znew*W3*covb4b5
                   + 2*W3*(Znew^2)*covb4b7 + 2*(W3^2)*Znew*covb5b7)      
    
    conse4 <- sqrt(varb1
                   + varb4*(Znew^2) + varb5*(W4^2) + varb7*(Znew^2)*(W4^2)
                   + 2*Znew*covb1b4 + 2*W4*covb1b5 + 2*Znew*W4*covb1b7 + 2*Znew*W4*covb4b5
                   + 2*W4*(Znew^2)*covb4b7 + 2*(W4^2)*Znew*covb5b7)    
  }else{
    conse0 <- sqrt(varb1         
                   + varb4*(Znew^2) + varb5*(W0^2) + varb7*(Znew^2)*(W0^2)
                   + 2*Znew*covb1b4 + 2*W0*covb1b5 + 2*Znew*W0*covb1b7 + 2*Znew*W0*covb4b5
                   + 2*W0*(Znew^2)*covb4b7 + 2*(W0^2)*Znew*covb5b7)
    
    conse1 <- sqrt(varb1         
                   + varb4*(Znew^2) + varb5*(W1^2) + varb7*(Znew^2)*(W1^2)      
                   + 2*Znew*covb1b4 + 2*W1*covb1b5 + 2*Znew*W1*covb1b7 + 2*Znew*W1*covb4b5
                   + 2*W1*(Znew^2)*covb4b7 + 2*(W1^2)*Znew*covb5b7)
    
    conse2 <- sqrt(varb1       
                   + varb4*(Znew^2) + varb5*(W2^2) + varb7*(Znew^2)*(W2^2) 
                   + 2*Znew*covb1b4 + 2*W2*covb1b5 + 2*Znew*W2*covb1b7 + 2*Znew*W2*covb4b5
                   + 2*W2*(Znew^2)*covb4b7 + 2*(W2^2)*Znew*covb5b7)
    
    conse3 <- sqrt(varb1
                   + varb4*(Znew^2) + varb5*(W3^2) + varb7*(Znew^2)*(W3^2)
                   + 2*Znew*covb1b4 + 2*W3*covb1b5 + 2*Znew*W3*covb1b7 + 2*Znew*W3*covb4b5
                   + 2*W3*(Znew^2)*covb4b7 + 2*(W3^2)*Znew*covb5b7)      
    
    conse4 <- sqrt(varb1
                   + varb4*(Znew^2) + varb5*(W4^2) + varb7*(Znew^2)*(W4^2)
                   + 2*Znew*covb1b4 + 2*W4*covb1b5 + 2*Znew*W4*covb1b7 + 2*Znew*W4*covb4b5
                   + 2*W4*(Znew^2)*covb4b7 + 2*(W4^2)*Znew*covb5b7)    
  }
  
  # Create t statistics
  t0 <- conb0/conse0
  t1 <- conb1/conse1
  t2 <- conb2/conse2
  t3 <- conb3/conse3
  t4 <- conb4/conse4
  
  # Make a `shadow' variable that is missing if the t score is not larger than the critical level of significance you want.
  ci <- NA
  ci[level == 95] <- qt(.975,M$df.residual)
  ci[level == 90] <- qt(.95,M$df.residual)
  
  stars.df <- data.frame(consb0=conb0,consb1=conb1,consb2=conb2,consb3=conb3,consb4=conb4,t0=t0,t1=t1,t2=t2,t3=t3,t4=t4)
  
  stars.df$consb0[abs(stars.df$t0)<ci] <- NA
  stars.df$consb1[abs(stars.df$t1)<ci] <- NA
  stars.df$consb2[abs(stars.df$t2)<ci] <- NA
  stars.df$consb3[abs(stars.df$t3)<ci] <- NA
  stars.df$consb4[abs(stars.df$t4)<ci] <- NA
  
  # Generate a string variable called txt that is designated with a star.
  txt <- c("*")
  
  # Graph the marginal effect of X on Y across the desired range of the modifying variable Z. Do this for when W=0, when W=1, when W=2, when W=3, and when W=4.                                   
  
  if(missing(hist)){
    plot(c(Znew,Znew,Znew,Znew,Znew,Znew,Znew,Znew,Znew,Znew), c(conb0,stars.df$consb0,conb1,stars.df$consb1,conb2,stars.df$consb2,conb3,stars.df$consb3,conb4,stars.df$consb4), type="n",xlab=xlab,ylab=ylab)+rug(jitter(Z))
    
    lines(Znew,conb0,col="blue")
    text(x=Znew,y=stars.df$consb0,labels=txt)
    lines(Znew,conb1,col="red")
    text(x=Znew,y=stars.df$consb1,labels=txt)
    lines(Znew,conb2,col="forest green")
    text(x=Znew,y=stars.df$consb2,labels=txt)
    lines(Znew,conb3,col="yellow")
    text(x=Znew,y=stars.df$consb3,labels=txt)
    lines(Znew,conb4,col="brown")
    text(x=Znew,y=stars.df$consb4,labels=txt)
    legend(lloc,legend=c(Min,Q1,Mean,Q3,Max),col=c("blue","red","forest green","yellow","brown"),lty = c("solid"))
    abline(h=0)
  }else{
    hist(Z, axes=F, xlab="", ylab="",main="", col="light gray")
    par(new=TRUE)
    plot(c(Znew,Znew,Znew,Znew,Znew,Znew,Znew,Znew,Znew,Znew), c(conb0,stars.df$consb0,conb1,stars.df$consb1,conb2,stars.df$consb2,conb3,stars.df$consb3,conb4,stars.df$consb4), type="n",xlab=xlab,ylab=ylab)
    
    lines(Znew,conb0,col="blue")
    text(x=Znew,y=stars.df$consb0,labels=txt)
    lines(Znew,conb1,col="red")
    text(x=Znew,y=stars.df$consb1,labels=txt)
    lines(Znew,conb2,col="forest green")
    text(x=Znew,y=stars.df$consb2,labels=txt)
    lines(Znew,conb3,col="yellow")
    text(x=Znew,y=stars.df$consb3,labels=txt)
    lines(Znew,conb4,col="brown")
    text(x=Znew,y=stars.df$consb4,labels=txt)
    legend(lloc,legend=c(Min,Q1,Mean,Q3,Max),col=c("blue","red","forest green","yellow","brown"),lty = c("solid"), cex = 0.5)
    abline(h=0)
  }
}



## Change df name --------------------------------------------------------------
eac <- aid_merged
rm(aid_merged)







# =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= # 
                  ####  II. EXPLORATORY DATA ANALYSIS  ####
# =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= # 

eac_names <- as.data.frame(variable.names(eac))
View(eac_names)

## 2a) Summary/Descriptive Stats Table -----------------------------------------

# select() vars to use in "" function below
descriptive_vars <- eac %>%
  ungroup() %>% 
  select(trendcrop, trendc3, trendcropveg, trendgrass,
         muni_locd, cropsha_pct01, SPI12m_mean, SPI12m_sd,
         upstream, altitude, road0,
         illegal_crops, vio_13,
         farc_zone, vio_15,
         starts_with("pres_"),
         num_range("pol_", 9:18),
         starts_with("c_"),
         starts_with("s_"),
         num_range("vio_", c(1:3, 9:11, 14, 26:28, 31:36, 46:47, 87)),
         vio_26_mean, vio_27_mean, vio_28_mean, vio_31_mean, vio_32_mean,
         vio_33_mean, vio_34_mean, vio_35_mean, vio_36_mean
  )

# "Inf" values in cropsha_pct01 compute descriptive stats properly
descriptive_vars %<>%
  mutate(cropsha_pct01 = if_else(is.infinite(cropsha_pct01),
                                 NA_real_,
                                 cropsha_pct01)
  )


# "overview" = as in overview or summary of vars. can't use summarize
overview <- function(descriptive_vars, stat){
 stat <- enquo(stat)
  
 overview_df <- descriptive_vars %>%
    summarise_all(stat, na.rm = TRUE) %>% 
    gather(key = "name_var", value = !!stat)
}

# df for each descriptive stat
summarized_mean <- overview(descriptive_vars, mean)
summarized_med <- overview(descriptive_vars, median)
summarized_sd <- overview(descriptive_vars, sd)
summarized_min <- overview(descriptive_vars, min)
summarized_max <- overview(descriptive_vars, max)


# "count # of non-NA observations" is not it's own summary function
summarized_n <- descriptive_vars %>%
  map_df(function(x) sum(!is.na(x))) %>%
  gather(key = "name_var", value = "n")


# summary stats table w/ var names and values across the row
summarized_vars <- bind_cols(summarized_n, summarized_mean, summarized_sd,
                             summarized_med, summarized_max, summarized_min)

# create a tidy df w/ no duplicate cols
summarized_vars %<>% select(-num_range("name_var", c(1:5)))

summarized_vars %<>% rename(Variable = name_var, Mean = mean, `Std Dev` = sd,
                            Median = median, Max = max, Min = min)



```

## Descriptive Stats for Covariates in Dataset

```{r descriptive}
# latex table
# (if latex wanted change chunk options to results="asis")
# xtable(summarized_vars, digits = 2)


summarized_var_html <- xtable(summarized_vars, digits = 2)
# print(summarized_var_html, type = "html",
#         html.table.attributes = "",
#         include.rownames = FALSE,
#         format.args = list(big.mark = ",")) %>% HTML() %>% browsable()

kable(summarized_var_html, digits = 2)
```




### Coca Presence

Between 1993-2015, municipalities are by and large going to fall under one of two categories: *"having coca crops present"* in their municipality or *"not having coca crops present"* in their municipality. **"illegal_crops"** is a dummy variable that counts whether there was coca growing in 2013. **"vio_13"** is the proportion of years (1993-2015) in which coca is present in a given municipality.

```{r, warning=FALSE}
ggplot(eac) + geom_bar(aes(x = illegal_crops))
eac %>% select(illegal_crops) %>% count()

# vio_13 (coca presence dummy)
ggplot(eac) + geom_freqpoly(aes(x = vio_13), binwidth = 0.05) # count
```




### Aid (muni_locd)

**muni_locd** is a dummy variable counting whether a municipality received aid from the World Bank at any time during the the time period. To determine whether an aid project "counts", we use precision codes 1, 2, or 3. Of note, data for World Bank Level 1 aid projects only record Precision Codes 1 or 3.


```{r, warning=FALSE}
eac$muni_locd <- as.integer(eac$muni_locd)
ggplot(data = eac) + geom_bar(mapping = aes(x = muni_locd))
eac %>% select(muni_locd) %>% count()
```




### Cropshare Trend/Change


**TRENDCROP** (MODIS crop)

* There's one major outlier in the measure of MODIS crop cover -- Uribia in the department of La Guajira.

* The municipality has a positive trend of 22274.58 $km^{2}$. There are no outliers even remotely close to this "far out" in the distribution on either tail. Models using MODIS crop cover (*trendcrop*) as a dependent variable will be run with and without the municipality of Uribia.

* The output below shows other variable that are further out in the tails for comparison. The plots showing the distribution have a limited x-axis for better visualization purposes. The histogram leaves out 13 values.

```{r, warning=FALSE}
ggplot(eac) +
  geom_freqpoly(aes(x = trendcrop), binwidth = 20)

# outliers
eac %>% select(codmuni, trendcrop) %>% filter(trendcrop > 500)
eac %>% select(codmuni, trendcrop) %>% filter(trendcrop < -500)

ggplot(eac) +
  geom_histogram(aes(x = trendcrop), binwidth = 20) +
  xlim(-500, 500)
```


**TRENDCROPVEG** (MODIS crop vegetation)

* Uribia of the department of La Guajira is again an outlier. The municipality has a positive trend of 10848.012. Below you can see other values that are also out in the tails of the distribution. As with the crop cover variable, we will run the models with and without Uribia included in the data.

```{r, warning=FALSE}
# outliers
eac %>%
  select(codmuni, department, municipality, trendcropveg) %>%
  filter(trendcropveg < -2000)
eac %>%
  select(codmuni, department, municipality, trendcropveg) %>%
  filter(trendcropveg > 4000)

# distribution with the limited x-axis
ggplot(eac) +
  geom_histogram(aes(x = trendcropveg), binwidth = 20) +
  xlim(-2000, 4000)


```




### Conflict Measures

```{r, warning=FALSE}
## vio_31-33: population exposure ----
# vio_31: exposure to state
ggplot(eac) + geom_histogram(aes(x = vio_31_mean), binwidth = .1)
# vio_32: exposure to guer
ggplot(eac) + geom_histogram(aes(x = vio_32_mean), binwidth = .1)
# vio_33: exposure to guer
ggplot(eac) + geom_histogram(aes(x = vio_33_mean), binwidth = .1)


## vio_34-36: dispute ----
# vio_34: state vs. guerilla conflict
ggplot(eac) + geom_histogram(aes(x = vio_34_mean), binwidth = .1)

# vio_35: state vs. paramilitary/neoparamilitary
ggplot(eac) + geom_histogram(aes(x = vio_35_mean), binwidth = .1)

# vio_36: guer vs. paramilitary/neoparamilitary
ggplot(eac) + geom_histogram(aes(x = vio_36_mean), binwidth = .1)


## vio_46: incidence of conflict ----
ggplot(eac) + geom_bar(aes(x = vio_46))
```



### A note on election variables:

Data for Camara ("House of Representatives") and Senado ("Senate") elections encompasses four elections from 2002-2014. Presidential election data covers five elections from 1998-2014. The election variables are dummies averaged over the elections to give a proportion of elections in which there is a "match" in ideology.


**c_match** variables indicate mutually exclusive categories where 1) *presdept* = the President's ideology & the majority ideology of Camara representatives at the department level are the same, 2) *munidept* = the majority ideology of department Camara representatives and the ideology with the highest municipality vote share (in Camara elections) are the same, 3) *munideptpres* = ideology of the president, camara reps, and highest municipality Camara vote share are the same. Coefficients are compared against the situation where there is no match in ideology from the president down to the municipality.


**s_match** variables indicate similarly mutually exclusive categories where 1) *presseat* = the president's ideology and the majority ideology of senators are the same, 2) *muniseatpres* = *presseat* plus a match with the ideology that received the highest vote share in Senate municipality elections. These two categories are compared against the situation where no ideology match occurs across the president, Senate majority, and municipality vote share.


**pres_pidmuni** = a match where the municipality ideology with the highest vote share in the presidential elections matches the president's ideology.




## Aid, Coca Presence, and CropVeg & Crop Cover

### Does receiving aid have an effect on *cropveg* trend? 
```{r, warning=FALSE}
cropveg_out <- eac %>% filter(trendcropveg < 8000)

## CROPVEG
# box plot
ggplot(cropveg_out, aes(muni_locd, trendcropveg, group = muni_locd)) +
  geom_boxplot()

# distribution by receiving/not receiving aid
cropveg_out$muni_locd_cat <- as.factor(cropveg_out$muni_locd)

ggplot(cropveg_out) +
  geom_freqpoly(aes(x = trendcropveg, color = muni_locd_cat), binwidth = 20)

ggplot(cropveg_out) +
  geom_freqpoly(aes(x = trendcropveg, y = ..density.., color = muni_locd_cat), binwidth = 20)
```


### Does receiving aid have an effect on *crop* trend? 
```{r, warning=FALSE}
crop_out <- eac %>% filter(trendcrop < 10000)

# boxplot
ggplot(crop_out, aes(muni_locd, trendcrop, group = muni_locd)) +
  geom_boxplot()

crop_out %>% filter(trendcrop < 2500) %>%
  ggplot(., aes(muni_locd, trendcrop, group = muni_locd)) +
  geom_boxplot()

# distribution by receiving/not receiving aid
crop_out$muni_locd_cat <- as.factor(crop_out$muni_locd)

ggplot(crop_out) +
  geom_freqpoly(aes(x = trendcrop, color = muni_locd_cat), binwidth = 30)

ggplot(crop_out) +
  geom_freqpoly(aes(x = trendcrop, y = ..density.., color = muni_locd_cat), binwidth = 30)
```


Obviously it's not immediately clear from the plots below -- which show the distribution of the cropveg cover trend and crop cover trend variables. Considering there are only 119 (agricultural) aid receiving municipalities and 1002 non-receiving, the distributions look fairly similar. The first box plot shows all variables, and the second takes out the outlier postive values in the first box plot to "zoom" in on the box a little more. The plot with "density" on the y-axis is as it seems -- the count is standardized so the area under the polygon is equal to one.


### Regression Tables and Marginal Effects Plots
```{r aid-coca, warning=FALSE}
## models ----
# 1) base model: cropshare = aid + coca
# 2) base model + aid*coca
# 3) base model + pol vars (_match_none dropped out!)
# 4) base model + aid*coca + pol vars

## VARS TO INCLUDE IN MODEL
dep_var <- ~trendcropveg
dep_var2 <- ~trendcrop
base_vars <- ~muni_locd + SPI12m_sd + geo_3 + upstream + altitude + vio_13
interact_vars <- ~muni_locd:vio_13
# political/election vars (camara, senate, president)
pol_vars <- ~c_match_presdept + c_match_munidept + c_match_munideptpres +
  pres_pidmuni + s_match_presseat + s_match_muniseatpres

# set models
# cropveg dv model
linear.model.form <- formulas(.response = dep_var,
                              base = base_vars,
                              interact =  add_predictors(base, interact_vars),
                              politics =  add_predictors(base, pol_vars),
                              full = add_predictors(politics, interact_vars)
)

# crop dv model
linear.model.form2 <- formulas(.response = dep_var2,
                              base = base_vars,
                              interact =  add_predictors(base, interact_vars),
                              politics =  add_predictors(base, pol_vars),
                              full = add_predictors(politics, interact_vars)
)


## LINEAR MODEL
linear.model <- map(linear.model.form, ~ lm(.x, data = eac, model = TRUE))
# w/out outlier (Uribia in La Guajira)
linear.model.out <- map(linear.model.form, ~ lm(.x, data = cropveg_out, model = TRUE))

linear.model2 <- map(linear.model.form2, ~ lm(.x, data = eac, model = TRUE))
# w/out outlier (Uribia in La Guajira)
linear.model.out2 <- map(linear.model.form2, ~ lm(.x, data = crop_out, model = TRUE))


## output regression tables ----------------------------------------------------

## TABLE TITLE - CROPVEG
title <- "Aid's Effect on MODIS Crop Veg Cover"
# title for the outlier table
title_out <- "Aid's Effect on MODIS Crop Veg Cover (without Uribia, La Guajira)"

## TABLE TITLE - CROP
title2 <- "Aid's Effect on MODIS Crop Cover"
title_out2 <- "Aid's Effect on MODIS Crop Cover (without Uribia, La Guajira)"

## RENAME VARS IN TABLE
coefnames <- list("(Intercept)" = NA, "muni_locd" = "Aid given",
                  "SPI12m_sd" = "SPI (std dev)", "geo_3" = "Muni area",
                  "upstream" = "Upstream", "altitude" = "Altitude",
                  "vio_13" = "Coca presence avg", "c_match_presdept" = NA,
                  "c_match_munidept" = NA, "c_match_munideptpres" = NA,
                  "pres_pidmuni" = NA, "s_match_presseat" = NA,
                  "s_match_muniseatpres" = NA,
                  "muni_locd:vio_13" = "Aid * Coca")

## NOTE FOR BOTTOM OF TABLE
# %stars puts p-value definitions in Note
note <- "%stars. OLS regressions with MODIS cropveg trend as the dependent
variable. 'c_match', 's_match', and 'pres_pidmuni' variables indicate mutually
exclusive categories compared against a category where there is no match
in ideology. Table shows robust standard errors."

note2 <- "%stars. OLS regressions with MODIS crop trend as the dependent
variable. 'c_match', 's_match', and 'pres_pidmuni' variables indicate mutually
exclusive categories compared against a category where there is no match
in ideology. Table shows robust standard errors."


## SHOW REG OUTPUT TABLE W/ ROBUST SEs
## table to html code

# cropveg tables
html_table <-  robust_table(linear.model, filename = NULL, title, coefnames, note,
                            latex = FALSE)
html_table %>% HTML() %>% browsable() # view the html in R's viewer

# w/out outlier
html_table_out <- robust_table(linear.model.out, filename = NULL, title_out, coefnames,
                               note, latex = FALSE)
html_table_out %>% HTML() %>% browsable()

# crop tables
html_table2 <- robust_table(linear.model2, filename = NULL, title2, coefnames, note2,
                            latex = FALSE)
html_table2 %>% HTML() %>% browsable()

html_table2_out <- robust_table(linear.model.out2, filename = NULL, title_out2,
                                coefnames, note2, latex = FALSE)
html_table2_out %>% HTML() %>% browsable()



# interaction plots -----------------------------------------------------------

## CROPVEG PLOTS
# aid*coca
interplot(m = linear.model[[2]], var1 = "muni_locd", var2 = "vio_13",
          hist = TRUE) +
  ylab("Aid's Effect on Crop Veg Cover") + xlab("Avg. Coca Presence") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Coca Presence (1993-2015)")

# aid*coca + pol
interplot(m = linear.model[[4]], var1 = "muni_locd", var2 = "vio_13",
          hist = TRUE) +
  ylab("Aid's Effect on Crop Veg Cover") + xlab("Avg. Coca Presence") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Coca Presence (1993-2015)",
          subtitle = "controlling for election effects")

## CROP PLOTS
title_ylab_crop <- "Aid's Effect on Crop Cover"
# aid*coca
interplot(m = linear.model2[[2]], var1 = "muni_locd", var2 = "vio_13",
          hist = TRUE) +
  ylab(title_ylab_crop) + xlab("Avg. Coca Presence") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Coca Presence (1993-2015)")

# aid*coca + pol
interplot(m = linear.model2[[4]], var1 = "muni_locd", var2 = "vio_13",
          hist = TRUE) +
  ylab(title_ylab_crop) + xlab("Avg. Coca Presence") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Coca Presence (1993-2015)",
          subtitle = "controlling for election effects")

```






## Aid, State-Guerilla Conflict, and CropVeg/Crop Cover

### Regression Tables and Marginal Effects Plots
```{r state-guer, warning=FALSE}
# 1) base model: cropshare = aid + state_guer conflict
# 2) base model + aid*state-guer
# 3) base model + pol vars
# 4) base model + pol vars + aid*state_guer

## models ----------------------------------------------------------------------

## VARS TO INCLUDE IN MODEL
base_vars <- ~muni_locd + SPI12m_sd + geo_3 + upstream + altitude +
              vio_34_mean + vio_31_mean + vio_32_mean
interact_vars <- ~muni_locd:vio_34_mean

# set models
linear.model.form <- formulas(.response = dep_var,
                              base = base_vars,
                              interact =  add_predictors(base, interact_vars),
                              politics =  add_predictors(base, pol_vars),
                              full = add_predictors(politics, interact_vars)
)

linear.model.form2 <- formulas(.response = dep_var2,
                              base = base_vars,
                              interact =  add_predictors(base, interact_vars),
                              politics =  add_predictors(base, pol_vars),
                              full = add_predictors(politics, interact_vars)
)

## LINEAR MODEL
linear.model <- map(linear.model.form, ~ lm(.x, data = eac, model = TRUE))
# w/out outlier (Uribia in La Guajira)
linear.model.out <- map(linear.model.form, ~ lm(.x, data = cropveg_out, model = TRUE))
linear.model2 <- map(linear.model.form2, ~ lm(.x, data = eac, model = TRUE))
linear.model.out2 <- map(linear.model.form2, ~ lm(.x, data = crop_out, model = TRUE))

## REGRESSION OUTPUT
# linear.model %>% map(summary)
# linear.model %>% map(robust)
# linear.model.out %>% map(summary)
# linear.model.out %>% map(robust)
# linear.model2 %>% map(summary)
# linear.model2 %>% map(robust)
# linear.model.out2 %>% map(summary)
# linear.model.out2 %>% map(robust)



## output regression tables ----------------------------------------------------

## RENAME VARS IN TABLE
coefnames <- list("(Intercept)" = NA, "muni_locd" = "Aid given",
                  "SPI12m_sd" = "SPI (std dev)", "geo_3" = "Muni area",
                  "upstream" = "Upstream", "altitude" = "Altitude",
                  "vio_34_mean" = "State-Guerilla Dispute",
                  "vio_31_mean" = "Exposure to State",
                  "vio_32_mean" = "Exposure to Guerillas",
                  "c_match_presdept" = NA, "c_match_munidept" = NA,
                  "c_match_munideptpres" = NA, "pres_pidmuni" = NA,
                  "s_match_presseat" = NA, "s_match_muniseatpres" = NA,
                  "muni_locd:vio_34_mean" = "Aid * State-Guer Dispute")

## NOTE FOR BOTTOM OF TABLE
# %stars puts p-value definitions in Note
note <- "%stars. OLS regressions with MODIS cropveg trend as the dependent
variable. 'c_match', 's_match', and 'pres_pidmuni' variables indicate mutually
exclusive categories compared against a category where there is no match
in ideology. 'State-Guerilla Dispute' = the
proportion of years (1998-2009) that government and guerilla forces have a
dispute in a given municipality. 'Exposure to State' = proportion of years
(1998-2009) that the non-combatant population comes in contact with government
forces. 'Exposure to Guerilla' = the same definition, but for guerilla forces.
Table shows robust standard errors."

note2 <- "%stars. OLS regressions with MODIS crop trend as the dependent
variable. 'c_match', 's_match', and 'pres_pidmuni' variables indicate mutually
exclusive categories compared against a category where there is no match
in ideology. 'State-Guerilla Dispute' = the
proportion of years (1998-2009) that government and guerilla forces have a
dispute in a given municipality. 'Exposure to State' = proportion of years
(1998-2009) that the non-combatant population comes in contact with government
forces. 'Exposure to Guerilla' = the same definition, but for guerilla forces.
Table shows robust standard errors."

## SHOW REG OUTPUT TABLE W/ ROBUST SEs
## table to html code

# cropveg tables
html_table <-  robust_table(linear.model, filename = NULL, title, coefnames, note,
                            latex = FALSE)
html_table %>% HTML() %>% browsable() # view the html in R's viewer

# w/out outlier
html_table_out <- robust_table(linear.model.out, filename = NULL, title_out, coefnames,
                               note, latex = FALSE)
html_table_out %>% HTML() %>% browsable()

# crop tables
html_table2 <- robust_table(linear.model2, filename = NULL, title2, coefnames, note2,
                            latex = FALSE)
html_table2 %>% HTML() %>% browsable()

html_table2_out <- robust_table(linear.model.out2, filename = NULL, title_out2,
                                coefnames, note2, latex = FALSE)
html_table2_out %>% HTML() %>% browsable()



## interaction plots -----------------------------------------------------------

## CROPVEG PLOTS
# aid*coca
interplot(m = linear.model[[2]], var1 = "muni_locd", var2 = "vio_34_mean",
          hist = TRUE) +
  ylab("Aid's Effect on Crop Veg Cover") +
  xlab("Proportion of State-Guerilla Disputes (1998-2009)") +
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by the Proportion of Disputes (1998-2009)")

# aid*coca + pol
interplot(m = linear.model[[4]], var1 = "muni_locd", var2 = "vio_34_mean",
          hist = TRUE) +
  ylab("Aid's Effect on Crop Veg Cover") +
  xlab("Proportion of State-Guerilla Disputes (1998-2009)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by the Proportion of Disputes (1998-2009)",
          subtitle = "controlling for election effects")


## CROP PLOTS
# aid*coca
interplot(m = linear.model2[[2]], var1 = "muni_locd", var2 = "vio_34_mean",
          hist = TRUE) +
  ylab(title_ylab_crop) +
  xlab("Proportion of State-Guerilla Disputes (1998-2009)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by the Proportion of Disputes (1998-2009)")

# aid*coca + pol
interplot(m = linear.model2[[4]], var1 = "muni_locd", var2 = "vio_34_mean",
          hist = TRUE) +
  ylab(title_ylab_crop) +
  xlab("Proportion of State-Guerilla Disputes (1998-2009)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by the Proportion of Disputes (1998-2009)",
          subtitle = "controlling for election effects")
```




## Aid, Conflict Incidence, and CropVeg/Crop Cover

### Regression Tables and Marignal Effects Plots
```{r, warning=FALSE}
# 1) base model: cropshare = aid + conflict incidence
# 2) base model + aid*conflict-incidence
# 3) base model + pol vars
# 4) base model + pol vars + aid*conflict-incidence

## models ----------------------------------------------------------------------

## VARS TO INCLUDE IN MODEL
base_vars <- ~muni_locd + SPI12m_sd + geo_3 + upstream + altitude +
  vio_46 + vio_31_mean + vio_32_mean
interact_vars <- ~muni_locd:vio_46

# set models
linear.model.form <- formulas(.response = dep_var,
                              base = base_vars,
                              interact =  add_predictors(base, interact_vars),
                              politics =  add_predictors(base, pol_vars),
                              full = add_predictors(politics, interact_vars)
)


linear.model.form2 <- formulas(.response = dep_var2,
                              base = base_vars,
                              interact =  add_predictors(base, interact_vars),
                              politics =  add_predictors(base, pol_vars),
                              full = add_predictors(politics, interact_vars)
)


## LINEAR MODEL
# cropveg
linear.model <- map(linear.model.form, ~ lm(.x, data = eac, model = TRUE))
# w/out outlier (Uribia in La Guajira)
linear.model.out <- map(linear.model.form, ~ lm(.x, data = cropveg_out, model = TRUE))

# crop
linear.model2 <- map(linear.model.form2, ~ lm(.x, data = eac, model = TRUE))
linear.model.out2 <- map(linear.model.form2, ~ lm(.x, data = crop_out, model = TRUE))



## output regression tables ----------------------------------------------------

## RENAME VARS IN TABLE
coefnames <- list("(Intercept)" = NA, "muni_locd" = "Aid given",
                  "SPI12m_sd" = "SPI (std dev)", "geo_3" = "Muni area",
                  "upstream" = "Upstream", "altitude" = "Altitude",
                  "vio_46" = "Conflict Incidence",
                  "vio_31_mean" = "Exposure to State",
                  "vio_32_mean" = "Exposure to Guerillas",
                  "c_match_presdept" = NA, "c_match_munidept" = NA,
                  "c_match_munideptpres" = NA, "pres_pidmuni" = NA,
                  "s_match_presseat" = NA, "s_match_muniseatpres" = NA,
                  "muni_locd:vio_46" = "Conflict Incidence")

## NOTE FOR BOTTOM OF TABLE
# %stars puts p-value definitions in Note
note <- "%stars. OLS regressions with MODIS cropveg trend as the dependent
variable. 'Conflict Incidence' takes on values 1-5 moving from low levels of
conflict occurence to high levels of conflict occurence. 'c_match', 's_match',
and 'pres_pidmuni' variables indicate mutually exclusive categories compared
against a category where there is no match in ideology. 'Exposure to State' = 
proportion of years (1998-2009) that the non-combatant population comes in
contact with government forces. 'Exposure to Guerilla' = the same definition,
but for guerilla forces. Table shows robust SEs."

note2 <- "%stars. OLS regressions with MODIS crop trend as the dependent
variable. 'Conflict Incidence' takes on values 1-5 moving from low levels of
conflict occurence to high levels of conflict occurence. 'c_match', 's_match',
and 'pres_pidmuni' variables indicate mutually exclusive categories compared
against a category where there is no match in ideology. 'Exposure to State' = 
proportion of years (1998-2009) that the non-combatant population comes in
contact with government forces. 'Exposure to Guerilla' = the same definition,
but for guerilla forces. Table shows robust SEs."


## SHOW REG OUTPUT TABLE W/ ROBUST SEs
## table to html code

# cropveg tables
html_table <-  robust_table(linear.model, filename = NULL, title, coefnames, note,
                            latex = FALSE)
html_table %>% HTML() %>% browsable() # view the html in R's viewer

# w/out outlier
html_table_out <- robust_table(linear.model.out, filename = NULL, title_out, coefnames,
                               note, latex = FALSE)
html_table_out %>% HTML() %>% browsable()

# crop tables
html_table2 <- robust_table(linear.model2, filename = NULL, title2, coefnames, note2,
                            latex = FALSE)
html_table2 %>% HTML() %>% browsable()

html_table2_out <- robust_table(linear.model.out2, filename = NULL, title_out2,
                                coefnames, note2, latex = FALSE)
html_table2_out %>% HTML() %>% browsable()


## interaction plots -----------------------------------------------------------

## CROPVEG PLOTS
# aid*coca
interplot(m = linear.model[[2]], var1 = "muni_locd", var2 = "vio_46",
          hist = TRUE) +
  ylab("Aid's Effect on Crop Veg Cover") + xlab("Conflict Incidence Index (2002-2013)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Conflict Incidence (2002-2013)")

# aid*coca + pol
interplot(m = linear.model[[4]], var1 = "muni_locd", var2 = "vio_46",
          hist = TRUE) +
  ylab("Aid's Effect on Crop Veg Cover") + xlab("Conflict Incidence Index (2002-2013)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Conflict Incidence (2002-2013)",
          subtitle = "controlling for election effects")


## CROP PLOTS
interplot(m = linear.model2[[2]], var1 = "muni_locd", var2 = "vio_46",
          hist = TRUE) +
  ylab(title_ylab_crop) + xlab("Conflict Incidence Index (2002-2013)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Conflict Incidence (2002-2013)")

# aid*coca + pol
interplot(m = linear.model2[[4]], var1 = "muni_locd", var2 = "vio_46",
          hist = TRUE) +
  ylab(title_ylab_crop) + xlab("Conflict Incidence Index (2002-2013)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Conflict Incidence (2002-2013)",
          subtitle = "controlling for election effects")

```




## Aid, Population Exposure to Fighting Groups, and CropVeg/Crop Cover

The first plot with *Population Exposure to State during Conflict* (vio_31_mean) or *Population Exposure to Guerillas during Conflict* (vio_32_mean) on the x-axis is the plot *without* the election variables in the model. The second plot with those respective variables contains the election variables in the model.


### Regression Tables and Marginal Effects Plots
```{r, warning=FALSE}
## model -----------------------------------------------------------------------

## VARS TO INCLUDE IN MODEL
base_vars <- ~muni_locd + SPI12m_sd + geo_3 + upstream + altitude +
  vio_31_mean + vio_32_mean + vio_13
interact_vars <- ~muni_locd:vio_31_mean
interact_vars2 <- ~muni_locd:vio_32_mean


# set models
linear.model.form <- formulas(.response = dep_var,
                              base = base_vars,
                              interact =  add_predictors(base, interact_vars),
                              interact2 = add_predictors(base, interact_vars2),
                              politics =  add_predictors(base, pol_vars),
                              full = add_predictors(politics, interact_vars),
                              full2 = add_predictors(politics, interact_vars2)
                      )

linear.model.form2 <- formulas(.response = dep_var2,
                              base = base_vars,
                              interact =  add_predictors(base, interact_vars),
                              interact2 = add_predictors(base, interact_vars2),
                              politics =  add_predictors(base, pol_vars),
                              full = add_predictors(politics, interact_vars),
                              full2 = add_predictors(politics, interact_vars2)
                      )


## LINEAR MODEL
# cropveg
linear.model <- map(linear.model.form, ~ lm(.x, data = eac, model = TRUE))
# w/out outlier (Uribia in La Guajira)
linear.model.out <- map(linear.model.form, ~ lm(.x, data = cropveg_out, model = TRUE))

# crop
linear.model2 <- map(linear.model.form2, ~ lm(.x, data = eac, model = TRUE))
linear.model.out2 <- map(linear.model.form2, ~ lm(.x, data = crop_out, model = TRUE))


## output regression tables ----------------------------------------------------

## RENAME VARS IN TABLE
coefnames <- list("(Intercept)" = NA, "muni_locd" = "Aid given",
                  "SPI12m_sd" = "SPI (std dev)", "geo_3" = "Muni area",
                  "upstream" = "Upstream", "altitude" = "Altitude",
                  "vio_31_mean" = "Exposure to State",
                  "vio_32_mean" = "Exposure to Guerillas",
                  "vio_13" = "Coca Presence Avg",
                  "c_match_presdept" = NA, "c_match_munidept" = NA,
                  "c_match_munideptpres" = NA, "pres_pidmuni" = NA,
                  "s_match_presseat" = NA, "s_match_muniseatpres" = NA,
                  "muni_locd:vio_31_mean" = "Aid * Exposure to State",
                  "muni_locd:vio_32_mean" = "Aid * Exposure to Guer")


## NOTE FOR BOTTOM OF TABLE
# %stars puts p-value definitions in Note
note <- "%stars. OLS regressions with MODIS cropveg trend as the dependent
variable. 'c_match', 's_match', and 'pres_pidmuni' variables indicate mutually 
exclusive categories compared against a category where there is no match in 
ideology. 'Exposure to State' = proportion of years (1998-2009) that the 
non-combatant population comes in contact with government forces. 'Exposure to 
Guerilla' = the same definition, but for guerilla forces. Table shows robust 
SEs."

note2 <- "%stars. OLS regressions with MODIS crop trend as the dependent
variable. 'c_match', 's_match', and 'pres_pidmuni' variables indicate mutually 
exclusive categories compared against a category where there is no match in 
ideology. 'Exposure to State' = proportion of years (1998-2009) that the 
non-combatant population comes in contact with government forces. 'Exposure to 
Guerilla' = the same definition, but for guerilla forces. Table shows robust 
SEs."


## SHOW REG OUTPUT TABLE W/ ROBUST SEs
## table to html code

# cropveg tables
html_table <-  robust_table(linear.model, filename = NULL, title, coefnames, note,
                            latex = FALSE)
html_table %>% HTML() %>% browsable() # view the html in R's viewer

# w/out outlier
html_table_out <- robust_table(linear.model.out, filename = NULL, title_out, coefnames,
                               note, latex = FALSE)
html_table_out %>% HTML() %>% browsable()

# crop tables
html_table2 <- robust_table(linear.model2, filename = NULL, title2, coefnames, note2,
                            latex = FALSE)
html_table2 %>% HTML() %>% browsable()

html_table2_out <- robust_table(linear.model.out2, filename = NULL, title_out2,
                                coefnames, note2, latex = FALSE)
html_table2_out %>% HTML() %>% browsable()


## interaction plots -----------------------------------------------------------

## CROPVEG PLOTS
# aid*vio_31_mean
interplot(m = linear.model[[2]], var1 = "muni_locd", var2 = "vio_31_mean",
          hist = TRUE) +
  ylab("Aid's Effect on Crop Veg Cover") +
  xlab("Muni Population's Exposure to State Conflict (2002-2013)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Exposure to Conflict (2002-2013)")

# aid*vio_31_mean
interplot(m = linear.model[[5]], var1 = "muni_locd", var2 = "vio_31_mean",
          hist = TRUE) +
  ylab("Aid's Effect on Crop Veg Cover") +
  xlab("Muni Population's Exposure to State Conflict (2002-2013)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Exposure to Conflict (2002-2013)")

# aid*vio_32_mean
interplot(m = linear.model[[3]], var1 = "muni_locd", var2 = "vio_32_mean",
          hist = TRUE) +
  ylab("Aid's Effect on Crop Veg Cover") +
  xlab("Muni Population's Exposure to Guer Conflict (2002-2013)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Exposure to Conflict (2002-2013)")

# aid*vio_32_mean
interplot(m = linear.model[[6]], var1 = "muni_locd", var2 = "vio_32_mean",
          hist = TRUE) +
  ylab("Aid's Effect on Crop Veg Cover") +
  xlab("Muni Population's Exposure to Guer Conflict (2002-2013)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Exposure to Conflict (2002-2013)")

##  CROP PLOTS
# aid*vio_31_mean
interplot(m = linear.model2[[2]], var1 = "muni_locd", var2 = "vio_31_mean",
          hist = TRUE) +
  ylab(title_ylab_crop) +
  xlab("Muni Population's Exposure to State Conflict (2002-2013)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Exposure to Conflict (2002-2013)")

# aid*vio_31_mean
interplot(m = linear.model2[[5]], var1 = "muni_locd", var2 = "vio_31_mean",
          hist = TRUE) +
  ylab(title_ylab_crop) +
  xlab("Muni Population's Exposure to State Conflict (2002-2013)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Exposure to Conflict (2002-2013)")

# aid*vio_32_mean
interplot(m = linear.model2[[3]], var1 = "muni_locd", var2 = "vio_32_mean",
          hist = TRUE) +
  ylab(title_ylab_crop) +
  xlab("Muni Population's Exposure to Guer Conflict (2002-2013)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Exposure to Conflict (2002-2013)")

# aid*vio_32_mean
interplot(m = linear.model2[[6]], var1 = "muni_locd", var2 = "vio_32_mean",
          hist = TRUE) +
  ylab(title_ylab_crop) +
  xlab("Muni Population's Exposure to Guer Conflict (2002-2013)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Exposure to Conflict (2002-2013)")

```




## Extra Tables & Figures

### Aid, Coca Presence (Dummy), and CropVeg/Crop Cover


#### Regression Tables and Marginal Effects Plots

```{r aid-coca-dummy, echo = FALSE}
# 1) base model: cropshare = aid + coca
# 2) base model + aid*coca
# 3) base model + pol vars (_match_none dropped out!)
# 4) base model + aid*coca + pol vars

## VARS TO INCLUDE IN MODEL
base_vars <- ~muni_locd + SPI12m_sd + geo_3 + upstream + altitude + illegal_crops
interact_vars <- ~muni_locd:illegal_crops

# set models
linear.model.form <- formulas(.response = dep_var,
                              base = base_vars,
                              interact =  add_predictors(base, interact_vars),
                              politics =  add_predictors(base, pol_vars),
                              full = add_predictors(politics, interact_vars)
)

linear.model.form2 <- formulas(.response = dep_var2,
                              base = base_vars,
                              interact =  add_predictors(base, interact_vars),
                              politics =  add_predictors(base, pol_vars),
                              full = add_predictors(politics, interact_vars)
)


## LINEAR MODEL
linear.model <- map(linear.model.form, ~ lm(.x, data = eac, model = TRUE))
# w/out outlier (Uribia in La Guajira)
linear.model.out <- map(linear.model.form, ~ lm(.x, data = cropveg_out, model = TRUE))


linear.model2 <- map(linear.model.form2, ~ lm(.x, data = eac, model = TRUE))
# w/out outlier (Uribia in La Guajira)
linear.model.out2 <- map(linear.model.form2, ~ lm(.x, data = crop_out, model = TRUE))



## output regression tables ----------------------------------------------------

## RENAME VARS IN TABLE
coefnames <- list("(Intercept)" = NA, "muni_locd" = "Aid given",
                  "SPI12m_sd" = "SPI (std dev)", "geo_3" = "Muni area",
                  "upstream" = "Upstream", "altitude" = "Altitude",
                  "illegal_crops" = "Coca Presence (1 = Yes)",
                  "c_match_presdept" = NA, "c_match_munidept" = NA,
                  "c_match_munideptpres" = NA, "pres_pidmuni" = NA,
                  "s_match_presseat" = NA, "s_match_muniseatpres" = NA,
                  "muni_locd:illegal_crops" = "Aid * Coca")

## NOTE FOR BOTTOM OF TABLE
# %stars puts p-value definitions in Note
note <- "%stars. OLS regressions with MODIS cropveg trend as the dependent
variable. 'c_match', 's_match', and 'pres_pidmuni' variables indicate mutually
exclusive categories compared against a category where there is no match
in ideology. 'Coca Presence' is a dummy variable counting measured coca growth
in 2013. Table shows robust standard errors."

note2 <- "%stars. OLS regressions with MODIS crop trend as the dependent
variable. 'c_match', 's_match', and 'pres_pidmuni' variables indicate mutually
exclusive categories compared against a category where there is no match
in ideology. 'Coca Presence' is a dummy variable counting measured coca growth
in 2013. Table shows robust standard errors."


## SHOW REG OUTPUT TABLE W/ ROBUST SEs
## table to html code

# cropveg tables
html_table <-  robust_table(linear.model, filename = NULL, title, coefnames, note,
                            latex = FALSE)
html_table %>% HTML() %>% browsable() # view the html in R's viewer

# w/out outlier
html_table_out <- robust_table(linear.model.out, filename = NULL, title_out, coefnames,
                               note, latex = FALSE)
html_table_out %>% HTML() %>% browsable()

# crop tables
html_table2 <- robust_table(linear.model2, filename = NULL, title2, coefnames, note2,
                            latex = FALSE)
html_table2 %>% HTML() %>% browsable()
 
html_table2_out <- robust_table(linear.model.out2, filename = NULL, title_out2,
                                coefnames, note2, latex = FALSE)
html_table2_out %>% HTML() %>% browsable()

## interaction plots ------------------------------------------------------------

## CROPVEG PLOTS
# aid*coca
interplot(m = linear.model[[2]], var1 = "muni_locd", var2 = "illegal_crops",
          hist = TRUE) +
  ylab("Aid's Effect on Crop Veg Cover") + xlab("Coca Presence (1 = yes)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Coca Presence (2013)")

# aid*coca + pol
interplot(m = linear.model[[4]], var1 = "muni_locd", var2 = "illegal_crops",
          hist = TRUE) +
  ylab("Aid's Effect on Crop Veg Cover") + xlab("Coca Presence (1 = yes)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Coca Presence (2013)",
          subtitle = "controlling for election effects")


## CROP PLOTS
# aid*coca
interplot(m = linear.model2[[2]], var1 = "muni_locd", var2 = "illegal_crops",
          hist = TRUE) +
  ylab(title_ylab_crop) + xlab("Coca Presence (1 = yes)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Coca Presence (2013)")

# aid*coca + pol
interplot(m = linear.model2[[4]], var1 = "muni_locd", var2 = "illegal_crops",
          hist = TRUE) +
  ylab(title_ylab_crop) + xlab("Coca Presence (1 = yes)") + 
  geom_hline(yintercept = 0, color="grey35", size = .3) +
  ggtitle("Estimated Coefficient of Aid by Coca Presence (2013)",
          subtitle = "controlling for election effects")
```







### Interacting Aid, State-Guerrilla Conflict, Coca


#### Regression Tables and Marginal Effects Plots

```{r triple-interact, warning=FALSE}
## model -----------------------------------------------------------------------

## VARS TO INCLUDE IN MODEL
base_vars <- ~muni_locd + SPI12m_sd + geo_3 + upstream + altitude +
  vio_34_mean + vio_31_mean + vio_32_mean + vio_13
interact_vars <- ~muni_locd:vio_34_mean:vio_13

# set models
linear.model.form <- formulas(.response = dep_var,
                              base = base_vars,
                              interact =  add_predictors(base, interact_vars),
                              politics =  add_predictors(base, pol_vars),
                              full = add_predictors(politics, interact_vars)
)

linear.model.form2 <- formulas(.response = dep_var2,
                              base = base_vars,
                              interact =  add_predictors(base, interact_vars),
                              politics =  add_predictors(base, pol_vars),
                              full = add_predictors(politics, interact_vars)
)


## LINEAR MODEL
# cropveg
linear.model <- map(linear.model.form, ~ lm(.x, data = eac, model = TRUE))
# w/out outlier (Uribia in La Guajira)
linear.model.out <- map(linear.model.form, ~ lm(.x, data = cropveg_out, model = TRUE))

# crop
linear.model2 <- map(linear.model.form2, ~ lm(.x, data = eac, model = TRUE))
linear.model.out2 <- map(linear.model.form2, ~ lm(.x, data = crop_out, model = TRUE))


## ONLY THE VARS AND THEIR INTERACTIONS
triple_effect <- lm(trendcropveg ~ muni_locd + vio_34_mean + vio_13 +
                      muni_locd:vio_34_mean:vio_13,
                      data = eac)

triple_effect2 <- lm(trendcrop ~ muni_locd + vio_34_mean + vio_13 +
                      muni_locd:vio_34_mean:vio_13,
                      data = eac)



## output regression tables ----------------------------------------------------

## RENAME VARS IN TABLE
coefnames <- list("(Intercept)" = NA, "muni_locd" = "Aid given",
                  "SPI12m_sd" = "SPI (std dev)", "geo_3" = "Muni area",
                  "upstream" = "Upstream", "altitude" = "Altitude",
                  "vio_46" = "Conflict Incidence",
                  "vio_31_mean" = "Exposure to State",
                  "vio_32_mean" = "Exposure to Guerillas",
                  "vio_13" = "Coca Presence Avg",
                  "c_match_presdept" = NA, "c_match_munidept" = NA,
                  "c_match_munideptpres" = NA, "pres_pidmuni" = NA,
                  "s_match_presseat" = NA, "s_match_muniseatpres" = NA,
                  "muni_locd:vio_34_mean:vio_13" = "Aid * Dispute * Coca")


## NOTE FOR BOTTOM OF TABLE
# %stars puts p-value definitions in Note
note <- "%stars. OLS regressions with MODIS cropveg trend as the dependent
variable. 'State-Guerilla Dispute' = the proportion of years (1998-2009) that
government and guerilla forces have a dispute in a given municipality. 
'c_match', 's_match', and 'pres_pidmuni' variables indicate mutually exclusive
categories compared against a category where there is no match in ideology. 
'Exposure to State' = proportion of years (1998-2009) that the non-combatant
population comes in contact with government forces. 'Exposure to Guerilla' = the 
same definition, but for guerilla forces. Table shows robust SEs."

note2 <- "%stars. OLS regressions with MODIS crop trend as the dependent
variable. 'State-Guerilla Dispute' = the proportion of years (1998-2009) that
government and guerilla forces have a dispute in a given municipality. 
'c_match', 's_match', and 'pres_pidmuni' variables indicate mutually exclusive
categories compared against a category where there is no match in ideology. 
'Exposure to State' = proportion of years (1998-2009) that the non-combatant
population comes in contact with government forces. 'Exposure to Guerilla' = the 
same definition, but for guerilla forces. Table shows robust SEs."


## SHOW REG OUTPUT TABLE W/ ROBUST SEs
## table to html code

# cropveg tables
html_table <-  robust_table(linear.model, filename = NULL, title, coefnames, note,
                            latex = FALSE)
html_table %>% HTML() %>% browsable() # view the html in R's viewer

# w/out outlier
html_table_out <- robust_table(linear.model.out, filename = NULL, title_out, coefnames,
                               note, latex = FALSE)
html_table_out %>% HTML() %>% browsable()

# crop tables
html_table2 <- robust_table(linear.model2, filename = NULL, title2, coefnames, note2,
                            latex = FALSE)
html_table2 %>% HTML() %>% browsable()
 
html_table2_out <- robust_table(linear.model.out2, filename = NULL, title_out2,
                                coefnames, note2, latex = FALSE)
html_table2_out %>% HTML() %>% browsable()



## interaction plots -----------------------------------------------------------

## HOLDING DISPUTE AT DIFFERENT LEVELS + CHANGING COCA
# only key vars + interactions

# CROPVEG PLOTS
ThreewayME.f(M = triple_effect,
             X = eac$muni_locd,
             Z = eac$vio_13,
             W = eac$vio_34_mean,
             xlab = "Proportion of Years w/ Coca Presence (1993-2015)",
             ylab = "Aid's Effect on Crop Veg Cover",
             lloc = "bottomright",
             Min = "Min Value",
             Q1 = "First Quantile",
             Mean = "Mean",
             Q3 = "Third Quantile",
             Max = "Max Value",
             level = 95,
             rob,
             hist
            )

# base model + interactions
ThreewayME.f(M = linear.model[[2]],
             X = eac$muni_locd,
             Z = eac$vio_13,
             W = eac$vio_34_mean,
             xlab = "Proportion of Years w/ Coca Presence (1993-2015)",
             ylab = "Aid's Effect on Crop Veg Cover",
             lloc = "topleft",
             Min = "Min Value",
             Q1 = "First Quantile",
             Mean = "Mean",
             Q3 = "Third Quantile",
             Max = "Max Value",
             level = 95,
             rob,
             hist
            )

# full model
ThreewayME.f(M = linear.model[[4]],
             X = eac$muni_locd,
             Z = eac$vio_13,
             W = eac$vio_34_mean,
             xlab = "Proportion of Years w/ Coca Presence (1993-2015)",
             ylab = "Aid's Effect on Crop Veg Cover",
             lloc = "bottomright",
             Min = "Min Value",
             Q1 = "First Quantile",
             Mean = "Mean",
             Q3 = "Third Quantile",
             Max = "Max Value",
             level = 95,
             rob,
             hist
            )

# CROP PLOTS
ThreewayME.f(M = triple_effect2,
             X = eac$muni_locd,
             Z = eac$vio_13,
             W = eac$vio_34_mean,
             xlab = "Proportion of Years w/ Coca Presence (1993-2015)",
             ylab = title_ylab_crop,
             lloc = "bottomright",
             Min = "Min Value",
             Q1 = "First Quantile",
             Mean = "Mean",
             Q3 = "Third Quantile",
             Max = "Max Value",
             level = 95,
             rob,
             hist
            )

# base model + interactions
ThreewayME.f(M = linear.model2[[2]],
             X = eac$muni_locd,
             Z = eac$vio_13,
             W = eac$vio_34_mean,
             xlab = "Proportion of Years w/ Coca Presence (1993-2015)",
             ylab = title_ylab_crop,
             lloc = "topleft",
             Min = "Min Value",
             Q1 = "First Quantile",
             Mean = "Mean",
             Q3 = "Third Quantile",
             Max = "Max Value",
             level = 95,
             rob,
             hist
            )

# full model
ThreewayME.f(M = linear.model2[[4]],
             X = eac$muni_locd,
             Z = eac$vio_13,
             W = eac$vio_34_mean,
             xlab = "Proportion of Years w/ Coca Presence (1993-2015)",
             ylab = title_ylab_crop,
             lloc = "bottomright",
             Min = "Min Value",
             Q1 = "First Quantile",
             Mean = "Mean",
             Q3 = "Third Quantile",
             Max = "Max Value",
             level = 95,
             rob,
             hist
            )


## HOLDING COCA PROPORTION @ DIFFERENT LEVELS + CHANGING DISPUTE

# CROPVEG PLOTS
# only key vars + interactions
ThreewayME.f(M = triple_effect,
             X = eac$muni_locd,
             Z = eac$vio_34_mean,
             W = eac$vio_13,
             xlab = "Proportion of Years w/ State-Guerilla Conflict (1998-2012)",
             ylab = "Aid's Effect on Crop Veg Cover",
             lloc = "topleft",
             Min = "Min Value",
             Q1 = "First Quantile",
             Mean = "Mean",
             Q3 = "Third Quantile",
             Max = "Max Value",
             level = 95,
             rob,
             hist
            )

# base model + interactions
ThreewayME.f(M = linear.model[[2]],
             X = eac$muni_locd,
             Z = eac$vio_34_mean,
             W = eac$vio_13,
             xlab = "Proportion of Years w/ State-Guerilla Conflict (1998-2012)",
             ylab = "Aid's Effect on Crop Veg Cover",
             lloc = "topleft",
             Min = "Min Value",
             Q1 = "First Quantile",
             Mean = "Mean",
             Q3 = "Third Quantile",
             Max = "Max Value",
             level = 95,
             rob,
             hist
            )

# full model
ThreewayME.f(M = linear.model[[4]],
             X = eac$muni_locd,
             Z = eac$vio_34_mean,
             W = eac$vio_13,
             xlab = "Proportion of Years w/ State-Guerilla Conflict (1998-2012)",
             ylab = "Aid's Effect on Crop Veg Cover",
             lloc = "topleft",
             Min = "Min Value",
             Q1 = "First Quantile",
             Mean = "Mean",
             Q3 = "Third Quantile",
             Max = "Max Value",
             level = 95,
             rob,
             hist
            )

# CROP PLOTS
# only key vars + interactions
ThreewayME.f(M = triple_effect2,
             X = eac$muni_locd,
             Z = eac$vio_34_mean,
             W = eac$vio_13,
             xlab = "Proportion of Years w/ State-Guerilla Conflict (1998-2012)",
             ylab = title_ylab_crop,
             lloc = "topleft",
             Min = "Min Value",
             Q1 = "First Quantile",
             Mean = "Mean",
             Q3 = "Third Quantile",
             Max = "Max Value",
             level = 95,
             rob,
             hist
            )

# base model + interactions
ThreewayME.f(M = linear.model2[[2]],
             X = eac$muni_locd,
             Z = eac$vio_34_mean,
             W = eac$vio_13,
             xlab = "Proportion of Years w/ State-Guerilla Conflict (1998-2012)",
             ylab = title_ylab_crop,
             lloc = "topleft",
             Min = "Min Value",
             Q1 = "First Quantile",
             Mean = "Mean",
             Q3 = "Third Quantile",
             Max = "Max Value",
             level = 95,
             rob,
             hist
            )

# full model
ThreewayME.f(M = linear.model2[[4]],
             X = eac$muni_locd,
             Z = eac$vio_34_mean,
             W = eac$vio_13,
             xlab = "Proportion of Years w/ State-Guerilla Conflict (1998-2012)",
             ylab = title_ylab_crop,
             lloc = "topleft",
             Min = "Min Value",
             Q1 = "First Quantile",
             Mean = "Mean",
             Q3 = "Third Quantile",
             Max = "Max Value",
             level = 95,
             rob,
             hist
            )

```




### Missingness: Coca Presence & State-Guerilla Dispute

The "Coca Presence" variables do not have a real issue with missing values in the cross-sectional data. The variable measuring the proportion of municipalities with coca growth from 1998-2015 only have two municipalities in which there are 0 measurements available across the time period. "Illegal Crops", the dummy variable for coca presence in 2013 has no missing values. As a reminder, these two variables come from separate sources. It is also worth noting that "no missing values" does not mean that the panel data is complete, i.e. it's possible for 'coca presence' to only have a few missing values for any given municipality between 1998 and 2015. (This is something we can go back and check).

The violence data from CERAC does have some issues with missing values. The 'State-Guerilla Dispute' and 'Population Exposure to Conflict' variables each have 137 missing values. This means that there are 137 municipalities for which there are no measurements for these conflict variables. They also happen to be the same municipalities.

A book chapter on the CERAC conflict data spends a few pages on the problem of missing data.[^1] The authors use descriptive statistics and basic visualizations to demonstrate that missingness seems to be tied to institutional development, and that it has decreased greatly across all municipalities over time. A bulk of the missing data come from Amazonas, Guainía, and Vaupés, which are sparsely populated and far from the areas of interest. However, the chapter doesn't provide any statistical tests for any conjectures. The tables below begin to fill this void.

The table below seems to confirm some of the thinking about the departments that are mostly comprised of the Amazon --- municipalities with a larger population seem to be less likely to have missing data in the conflict measures of interest. It's possible that this is largely driven by the sparsely populated Amazonía region. The table also shows that municipalities with a higher incidence of conflict tend to be less likely to have missing data. Lastly, there are two "displacement" variables that estimate a lower probability of missing values in the municipalities that have a higher estimation of displaced persons. Although, these estimates do not fall below the .1 or .05 level.


[^1]: Granada, Soledad, Jorge Restrepo, and Camilo Sanchez Meertens. *Guerra y Violencias en Colombia: Herramientas e interpretaciones*, "Controlando la medición: alcances y limitaciones de la información en conflictos armados". p. 203-232.



#### Logit Regression Tables

```{r missing, warning=FALSE}
## MISSING VALUES?
eac %>% count(is.na(vio_34_mean)) # 137 missing values
eac %>% count(is.na(vio_13)) # no missingness
eac %>% count(is.na(illegal_crops))  # only 2 missing values
# same 137 missing
# '02_analysis_eac.R' gives table of these munis
eac %>% count(is.na(vio_31_mean))
eac %>% count(is.na(vio_32_mean))

eac %<>%
  mutate(
    missing_stateguer = if_else(is.na(vio_34_mean),
                                1,
                                0,
                                NA_real_)
    )


## model -----------------------------------------------------------------------

## PREDICT MISSINGNESS
dv_missing <- ~missing_stateguer
missing1 <- ~geo_3 + altitude + demo_3_mean + vio_13 + vio_46 + vio_29
missing2 <- ~geo_3 + demo_3_mean + vio_13 + vio_46 + vio_29
missing3 <- ~geo_3 + altitude + demo_3_mean + vio_13 + vio_46 + vio_30
missing4 <- ~geo_3 + demo_3_mean + vio_13 + vio_46 + vio_30


logit.missing.form <- formulas(.response = dv_missing,
                    missing1 = missing1,
                    missing2 = missing2,
                    missing3 = missing3,
                    missing4 = missing4
                    )

logit.missing <- map(logit.missing.form, ~ glm(.x,
                                                family = binomial(link='logit'),
                                                data = eac, model = TRUE))

# logit.missing %>% map(summary)


## output regression tables ----------------------------------------------------

## TITLE
title_missing <- "Predicting Missing Values in Key Violence Measures"

## RENAME VARS IN TABLE
coefnames <- list("(Intercept)" = NA,
                  "geo_3" = "Muni area",
                  "altitude" = "Altitude",
                  "vio_46" = "Conflict Incidence",
                  "vio_13" = "Coca Presence Avg",
                  "vio_29" = "People Displaced ('Chapman')",
                  "vio_30" = "People Displaced ('Lincoln-Petersen')",
                  "demo_3_mean" = "Avg Municipality Population"
                  )

## NOTE FOR BOTTOM OF TABLE
# %stars puts p-value definitions in Note
note <- "%stars. Logit regression estimating the likelihood of a missing value 
for 'State-Guerilla Dispute' and the 'Population Exposure' variables (missing 
values are consistent for the same municipalities in the CERAC database). There 
are 137 missing values, i.e. municipalities not represented in the dispute and
exposure variables."

## SAVE REG OUTPUT TABLE W/ ROBUST SEs
## html table
# 'predicting missing values' table
html_table <- robust_table(logit.missing, filename = NULL, title_missing, coefnames,
             note, latex = FALSE)
html_table %>% HTML() %>% browsable() # view the html in R's viewer

```




## Thoughts and Takeaways

It seems pretty clear (from this analysis anyway) that there are differences between aid's relationship with cropland coverage vs. its relationship with cropland/natural vegetation cover. As a reminder, the **crop** variable is the MODIS cropland coverage measurement defined as "lands covered with temporary crops followed by harvest and a bare soil period (e.g., single and multiple cropping systems). Note that perennial woody crops will be classified as the appropriate forest or shrub land cover type." [^2]. **Cropveg** is a MODIS land cover measurement defined as "lands with a mosaic of croplands, forests, shrubland, and grasslands in which no one component comprises more than 60% of the landscape."

There does not appear to be much of an effect on cropland due to aid targeting in municipalities. However, there does appear to be a relationships with aid targeting and the cropland/natural vegetation coverage. Since we know that there is not an observed change in cropland coverage, the positive trend we generally see for aid both unconditionally and conditioned by coca or conflict, must be coming from increases in natural vegetation (forests, grasslands, shrubs) in aid targeted areas. What is significant about this increase in natural vegetation? Here a few things to think about:


* Is the increase in vegetation due to some sort of perennial woody crop that is now planted due to agricultural aid? Coffee is one example of a perennial woody crop, and the coffee industry has grown rapidly in recent years.

* Is the increase in natural vegetation due to a population's displacement or movement in the previous years? People abandon or leave croplands and natural vegetation creeps in. Aid then comes in after a population has moved and natural vegetation starts to creep in at that same time period.

* Is the increase in natural vegetation related to coca fields being abandoned and being replaced with something else?

It would be helpful to look at some examples of agricultural aid projects and see exactly their intentions and goals. For example, are World Bank agricultural aid projects looking to explicitly target coca crops or are these aid projects looking to help plant something new?


[^2]: "Perennial" meaning a crop that stays for two years or more.
